<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta content="text/html; charset=UTF-8" http-equiv="content-type">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="/html/btp/jquery.js"></script>
		<title>tipoContaModelo</title>
		<style>
			table, td, th {
				border:solid;
			}

			.colx {
				display: none;
			}
		</style>
		<script src="/html/btp/jquery.js"></script>
	</head>
	<body>
		<div class="container">
			<div class="row-fluid"> 
				<a href="/html/modelos/financeiro/tipoContaModelo.html" target="_blank">
					<h1>Tipo de Conta (Modelo)</h1>
				</a>
				<h2>Vertical (basic) form</h2>
				<form id="tipoContaModeloFrm">
					<div class="form-group" id="codModeloDiv"> 
						<label for="codModelo">codModelo</label>
						<input 
							class="form-control" id="codModelo" name="codModelo" 
							aria-describedby="codModeloHelp"
							placeholder="codModelo" type="number"> 
						<br>
						<small id="codModeloHelp"
							   class="form-text text-muted">codModelo</small>
					</div>
					
					<div class="form-group" id="descricaoDiv"> 
						<label for="descricao">descricao</label>
						<input class="form-control" id="descricao" name="descricao" 
							   placeholder="descricao" type="text">
					</div>

					<div class="form-group" id="codTipoGastoDiv"> 
						<label for="codTipoGasto">codTipoGasto</label>
						<input class="form-control" id="codTipoGasto" name="codTipoGasto" 
							   placeholder="codTipoGasto" type="number">
					</div>

					<div class="form-group" id="codCategoriaDiv"> 
						<label for="codCategoria">codCategoria</label>
						<input class="form-control" id="codCategoria" name="codCategoria" 
							   placeholder="codCategoria" type="number">
					</div>

				</form>
			</div>
			<div class="row-fluid">
				<button class="btn btn-primary">Salvar</button> 
				<button class="btn btn-danger">Excluir</button> 
			</div>
		</div>
	</body>
</html>

<script>

	var variavel = 0;

	function preencheForm() {
		var url = "/cgi-bin/financeiro/tipoContaModelo.py";

		if (variavel > 0) {
			url += "?cod=" + variavel;
		}

		$.getJSON(url, function (data) {

			console.log(data);
			var obj = data.tipoContaModelo;

			$("#codModelo").val(obj[0].codModelo);
			$("#descricao").val(obj[0].descricao);
			$("#codTipoGasto").val(obj[0].codTipoGasto);
			$("#codCategoria").val(obj[0].codCategoria);
		})
		.done(function( json ) {
			carregaCombos();
		});
	}

	function formNull() {
		$("#codModelo").val(0);
		$("#descricao").val("");
		$("#codTipoGasto").val(0);
		$("#codCategoria").val(0);
	}

	$("form").submit(function (event) {
		event.preventDefault();
	});

	function carregaCombos() {
		var param = "";
		
		param = encodeURI("cod=" + $("#codTipoGasto").val());
		$("#codTipoGastoDiv").attr('param', param);
		$("#codTipoGastoDiv").load("/html/modelos/financeiro/tipoGastoCmb.html");

		param = encodeURI("cod=" + $("#codCategoria").val());
		$("#codCategoriaDiv").attr('param', param);
		$("#codCategoriaDiv").load("/html/modelos/financeiro/categoriaContaCmb.html");
	}

	$(document).ready(function () {
		formNull();
		//$("#codModeloDiv").css("display", "none");

		$("button").on("click", function(){
			var txt = $(this).html();
			var action = "/cgi-bin/financeiro/salvaTipoContaModelo.py";
			var dados = "";
			
			if (txt === "Salvar") {
				dados = $("#tipoContaModeloFrm").serialize();
			} else if (txt === "Excluir") {
				dados = $("#tipoContaModeloFrm").serialize() + "&delete=True";
			}
			
			$.post(
				action, 
				dados, 
				function(data) {
					alert("Dados salvos!");
					//console.log(data);
				}
			)
		});
		
		
		//procura na url da pagina
		var urlParams = new URLSearchParams(window.location.search);

		if ((urlParams.has('cod'))){
			variavel = urlParams.get("cod");
			preencheForm();
		}

		//procura na div container
		let params = decodeURI(
			$("#codContaDiv")
			.parent()
			.parent()
			.parent()
			.parent()
			.attr('param')
		);

		let searchParams = new URLSearchParams(params);
		
		if (searchParams.has("cod")){
			variavel = searchParams.get("cod");
			preencheForm();
		}
		
		carregaCombos();

	});
	
</script>
