<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width">
		<script src="/html/btp/jquery.js"></script>
		<style>
			tr, td, table {
				border: solid;
				border-width: thin;
			}
		</style>
		<title>Detalhes</title>
	</head>
	<body>
		<div class="container">
			<h1 id="titulo">Titulo</h1>
			<hr>
			<a class="" target="_blank" id="novoRegistro" href="">(novo)</a>
			<br><br>
			<table>
				<thead>
					<tr>
						<th>Campo</th>
						<th>Registro</th>
						<th>&nbsp;</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
			<button id="voltarBtn" class="btn btn-primary">Voltar</button>
		</div>

		<script>

			$("#voltarBtn").on("click", function(){
				if ($("#principal").length > 0){
					$("#principal").attr("url", 
						$("#principal").attr("urlPrev"));
					$("#principal").load($("#principal").attr("url"));
				}
			});


			$(document).ready(function(){

				var searchParams = "";
				var url = "/cgi-bin/passmots/registrosOrigem.py";

				if ($("#principal").length > 0) {
					searchParams = $("#principal").attr("url").split("?")[1];
				} else {
					searchParams = window.location.search;
				}

				searchParams = new URLSearchParams(searchParams);

				if (searchParams.has('cod')) {
					url += "?cod=" + searchParams.get('cod');
				}


				$.getJSON(url, function (data) {
					//console.log(data);

					var lista = data.registros;
					var saida = "";
			
					$("#titulo").html(data.origemRegistro);
					$("#novoRegistro").attr(
						"href", 
						"/html/modelos/passmots/registro.html?cod2=" + data.codOrigemRegistro
					);

					for (i = 0; i < lista.length; i++) {

						obj = lista[i];

						saida += "<tr><td>" +
							"<a href='/html/modelos/passmots/registro.html?cod=" +
							obj.codRegistro +
							"' target='_blank'>" +
							"<span " +
								"id='reg" + obj.codRegistro + "span'>" +
								obj.ordem + " - " + obj.tipoCampo +
							"</span></a></td><td>" +
							obj.registro +
							"</td><td>" +
							"<button class='glyphicon glyphicon-copy copy' " +
								"id='reg" +
									obj.codRegistro +
							"btn'><span></span></button>" +
							"</td></tr>";
					}
			
					$("tbody").append(saida);
				}).done(function(){
					$(".copy").on("click", function(){
						event.stopPropagation();
						//alert( $(this).attr("id") );
						alert("vamos copiar!\nmas n√£o agora!");
					});
				})
			});



// Assuming "?post=1234&action=edit"

//var urlParams = new URLSearchParams(window.location.search);

//console.log(urlParams.has('post')); // true
//console.log(urlParams.get('action')); // "edit"
//console.log(urlParams.getAll('action')); // ["edit"]
//console.log(urlParams.toString()); // "?post=1234&action=edit"
//console.log(urlParams.append('active', '1')); // "?post=1234&action=edit&active=1"

		</script>
	</body>
</html>

